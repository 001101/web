angular.module("bit",["ui.router","ngMessages","angular-jwt","angular-md5","ui.bootstrap.showErrors","toastr","angulartics","angulartics.google.analytics","bit.directives","bit.services","bit.global","bit.accounts","bit.vault","bit.settings","bit.tools"]),angular.module("bit").constant("appSettings",{rememberedEmailCookieName:"bit.rememberedEmail",apiUri:"https://api.bitwarden.com",version:"1.6.0",environment:"Production"}),angular.module("bit.accounts",["ui.bootstrap","ngCookies"]),angular.module("bit.directives",[]),angular.module("bit.global",[]),angular.module("bit.services",["ngResource","ngStorage","angular-jwt"]),angular.module("bit.settings",["ui.bootstrap","toastr"]),angular.module("bit.tools",["ui.bootstrap","toastr"]),angular.module("bit.vault",["ui.bootstrap","ngclipboard"]),angular.module("bit").factory("apiInterceptor",["$injector","$q","toastr",function(e,t,r){return{request:function(e){return e},response:function(o){return 401!==o.status&&403!==o.status||(e.get("authService").logOut(),e.get("$state").go("frontend.login.info").then(function(){r.warning("Your login session has expired.","Logged out")})),o||t.when(o)},responseError:function(o){return 401!==o.status&&403!==o.status||(e.get("authService").logOut(),e.get("$state").go("frontend.login.info").then(function(){r.warning("Your login session has expired.","Logged out")})),t.reject(o)}}}]),angular.module("bit").config(["$stateProvider","$urlRouterProvider","$httpProvider","jwtInterceptorProvider","$uibTooltipProvider","toastrConfig",function(e,t,r,o,n,a){o.urlParam="access_token",o.tokenGetter=["config","appSettings","tokenService",function(e,t,r){return 0===e.url.indexOf(t.apiUri)?r.getToken():void 0}],angular.extend(a,{closeButton:!0,progressBar:!0,showMethod:"slideDown",target:".toast-target"}),n.options({popupDelay:600}),r.defaults.headers.post&&(r.defaults.headers.post={}),r.defaults.headers.post["Content-Type"]="text/plain; charset=utf-8",r.interceptors.push("apiInterceptor"),r.interceptors.push("jwtInterceptor"),t.otherwise("/"),e.state("backend",{templateUrl:"app/views/backendLayout.html","abstract":!0,data:{authorize:!0}}).state("backend.vault",{url:"^/",templateUrl:"app/vault/views/vault.html",controller:"vaultController",data:{pageTitle:"My Vault"}}).state("backend.settings",{url:"^/settings",templateUrl:"app/settings/views/settings.html",controller:"settingsController",data:{pageTitle:"Settings"}}).state("backend.tools",{url:"^/tools",templateUrl:"app/tools/views/tools.html",controller:"toolsController",data:{pageTitle:"Tools"}}).state("frontend",{templateUrl:"app/views/frontendLayout.html","abstract":!0,data:{authorize:!1}}).state("frontend.login",{templateUrl:"app/accounts/views/accountsLogin.html",controller:"accountsLoginController",data:{bodyClass:"login-page"}}).state("frontend.login.info",{url:"^/login",templateUrl:"app/accounts/views/accountsLoginInfo.html",data:{pageTitle:"Log In"}}).state("frontend.login.twoFactor",{url:"^/login/two-factor",templateUrl:"app/accounts/views/accountsLoginTwoFactor.html",data:{pageTitle:"Log In (Two Factor)",authorizeTwoFactor:!0}}).state("frontend.logout",{url:"^/logout",controller:"accountsLogoutController",data:{authorize:!0}}).state("frontend.passwordHint",{url:"^/password-hint",templateUrl:"app/accounts/views/accountsPasswordHint.html",controller:"accountsPasswordHintController",data:{pageTitle:"Master Password Hint",bodyClass:"login-page"}}).state("frontend.recover",{url:"^/recover",templateUrl:"app/accounts/views/accountsRecover.html",controller:"accountsRecoverController",data:{pageTitle:"Recover Account",bodyClass:"login-page"}}).state("frontend.register",{url:"^/register",templateUrl:"app/accounts/views/accountsRegister.html",controller:"accountsRegisterController",data:{pageTitle:"Register",bodyClass:"register-page"}})}]).run(["$rootScope","authService","jwtHelper","tokenService","$state",function(e,t,r,o,n){e.$on("$stateChangeStart",function(e,a,s){return a.data&&a.data.authorize?void(t.isAuthenticated()&&!r.isTokenExpired(o.getToken())||(e.preventDefault(),t.logOut(),n.go("frontend.login.info"))):void(t.isAuthenticated()&&!r.isTokenExpired(o.getToken())&&(e.preventDefault(),n.go("backend.vault")))})}]),angular.module("bit.accounts").controller("accountsLoginController",["$scope","$rootScope","$cookies","apiService","cryptoService","authService","$state","appSettings","$analytics",function(e,t,r,o,n,a,s,i,l){var c=r.get(i.rememberedEmailCookieName);c&&(e.model={email:c,rememberEmail:!0}),e.login=function(t){e.loginPromise=a.logIn(t.email,t.masterPassword),e.loginPromise.then(function(){if(t.rememberEmail){var e=new Date;e.setFullYear(e.getFullYear()+10),r.put(i.rememberedEmailCookieName,t.email,{expires:e})}else r.remove(i.rememberedEmailCookieName);var o=a.getUserProfile();o.twoFactor?(l.eventTrack("Logged In To Two-step"),s.go("frontend.login.twoFactor")):(l.eventTrack("Logged In"),s.go("backend.vault"))})},e.twoFactor=function(t){e.twoFactorPromise=a.logInTwoFactor(t.code,"Authenticator"),e.twoFactorPromise.then(function(){l.eventTrack("Logged In From Two-step"),s.go("backend.vault")})}}]),angular.module("bit.accounts").controller("accountsLogoutController",["$scope","authService","$state","$analytics",function(e,t,r,o){t.logOut(),o.eventTrack("Logged Out"),r.go("frontend.login.info")}]),angular.module("bit.accounts").controller("accountsPasswordHintController",["$scope","$rootScope","apiService",function(e,t,r){e.success=!1,e.submit=function(t){e.submitPromise=r.accounts.postPasswordHint({email:t.email},function(){e.success=!0}).$promise}}]),angular.module("bit.accounts").controller("accountsRecoverController",["$scope","apiService","cryptoService",function(e,t,r){e.success=!1,e.submit=function(o){var n=o.email.toLowerCase(),a=r.makeKey(o.masterPassword,n),s={email:n,masterPasswordHash:r.hashPassword(o.masterPassword,a),recoveryCode:o.code.replace(/\s/g,"").toLowerCase()};e.submitPromise=t.accounts.postTwoFactorRecover(s,function(){e.success=!0}).$promise}}]),angular.module("bit.accounts").controller("accountsRegisterController",["$scope","$location","apiService","cryptoService","validationService","$analytics",function(e,t,r,o,n,a){var s=t.search();e.success=!1,e.model={email:s.email},e.registerPromise=null,e.register=function(t){var s=!1;if(e.model.masterPassword.length<8&&(n.addError(t,"MasterPassword","Master password must be at least 8 characters long.",!0),s=!0),e.model.masterPassword!==e.model.confirmMasterPassword&&(n.addError(t,"ConfirmMasterPassword","Master password confirmation does not match.",!0),s=!0),!s){var i=e.model.email.toLowerCase(),l=o.makeKey(e.model.masterPassword,i),c={name:e.model.name,email:i,masterPasswordHash:o.hashPassword(e.model.masterPassword,l),masterPasswordHint:e.model.masterPasswordHint};e.registerPromise=r.accounts.register(c,function(){e.success=!0,a.eventTrack("Registered")}).$promise}}}]),angular.module("bit.directives").directive("apiField",function(){var e=function(e,t,r,o){function n(){return o.$setValidity("api",!0),!0}function a(){o.$setValidity("api",!1)}o.$registerApiError=a,o.$validators.apiValidate=n};return{require:"ngModel",restrict:"A",compile:function(t,r){if(!r.name||""===r.name)throw"api-field element does not have a valid name attribute";return e}}}),angular.module("bit.directives").directive("apiForm",["$rootScope","validationService",function(e,t){function r(e,r,o){o&&o.then&&(e.$errors=null,e.$loading=!0,o.then(function(t){e.$loading=!1},function(o){e.$loading=!1,t.addErrors(e,o),r.$broadcast("show-errors-check-validity")}))}return{require:"form",restrict:"A",link:function(e,t,o,n){var a=o.apiForm||null;void 0!==a&&e.$watch(a,r.bind(null,n,e))}}}]),angular.module("bit.directives").directive("masterPassword",["cryptoService","authService",function(e,t){return{require:"ngModel",restrict:"A",link:function(r,o,n,a){var s=t.getUserProfile();s&&(a.$parsers.unshift(function(t){if(t){var r=e.makeKey(t,s.email,!0),o=r===e.getKey(!0);return a.$setValidity("masterPassword",o),o?t:void 0}}),a.$formatters.unshift(function(t){if(t){var r=e.makeKey(t,s.email,!0),o=r===e.getKey(!0);return a.$setValidity("masterPassword",o),t}}))}}}]),angular.module("bit.directives").directive("pageTitle",["$rootScope","$timeout","appSettings",function(e,t,r){return{link:function(r,o){var n=function(e,r,n,a,s){var i="bitwarden Password Manager";r.data&&r.data.pageTitle&&(i=r.data.pageTitle+" - bitwarden Password Manager"),t(function(){o.text(i)})};e.$on("$stateChangeStart",n)}}}]),angular.module("bit.directives").directive("passwordMeter",function(){return{template:'<div class="progress {{outerClass}}"><div class="progress-bar progress-bar-{{valueClass}}" role="progressbar" aria-valuenow="{{value}}" aria-valuemin="0" aria-valuemax="100" ng-style="{width : ( value + \'%\' ) }"><span class="sr-only">{{value}}%</span></div></div>',restrict:"A",scope:{password:"=passwordMeter",username:"=passwordMeterUsername",outerClass:"@?"},link:function(e){var t=function(e,t){if(!t||t===e)return 0;var r=t.length;return e&&""!==e&&(-1!==e.indexOf(t)&&(r-=15),-1!==t.indexOf(e)&&(r-=e.length)),t.length>0&&t.length<=4?r+=t.length:t.length>=5&&t.length<=7?r+=6:t.length>=8&&t.length<=15?r+=12:t.length>=16&&(r+=18),t.match(/[a-z]/)&&(r+=1),t.match(/[A-Z]/)&&(r+=5),t.match(/\d/)&&(r+=5),t.match(/.*\d.*\d.*\d/)&&(r+=5),t.match(/[!,@,#,$,%,^,&,*,?,_,~]/)&&(r+=5),t.match(/.*[!,@,#,$,%,^,&,*,?,_,~].*[!,@,#,$,%,^,&,*,?,_,~]/)&&(r+=5),t.match(/(?=.*[a-z])(?=.*[A-Z])/)&&(r+=2),t.match(/(?=.*\d)(?=.*[a-z])(?=.*[A-Z])/)&&(r+=2),t.match(/(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!,@,#,$,%,^,&,*,?,_,~])/)&&(r+=2),r=Math.round(2*r),Math.max(0,Math.min(100,r))},r=function(e){switch(Math.round(e/33)){case 0:case 1:return"danger";case 2:return"warning";case 3:return"success"}},o=function(e){e.value=t(e.username,e.password),e.valueClass=r(e.value)};e.$watch("password",function(){o(e)}),e.$watch("username",function(){o(e)})}}}),angular.module("bit.directives").directive("passwordViewer",function(){return{restrict:"A",link:function(e,t,r){var o=r.passwordViewer;o&&(t.onclick=function(e){},t.on("click",function(e){var r=$(o);r&&"password"===r.attr("type")?(t.removeClass("fa-eye").addClass("fa-eye-slash"),r.attr("type","text")):r&&"text"===r.attr("type")&&(t.removeClass("fa-eye-slash").addClass("fa-eye"),r.attr("type","password"))}))}}}),angular.module("bit.global").controller("mainController",["$scope","$state","authService","appSettings","toastr",function(e,t,r,o,n){var a=this;a.bodyClass="",a.userProfile=null,a.searchVaultText=null,a.version=o.version,e.currentYear=(new Date).getFullYear(),e.$on("$viewContentLoaded",function(){$.AdminLTE&&($.AdminLTE.layout&&($.AdminLTE.layout.fix(),$.AdminLTE.layout.fixSidebar()),$.AdminLTE.pushMenu&&$.AdminLTE.pushMenu.expandOnHover())}),e.$on("$stateChangeSuccess",function(e,t,o,n,s){return a.searchVaultText=null,a.userProfile=r.getUserProfile(),t.data.bodyClass?void(a.bodyClass=t.data.bodyClass):void(a.bodyClass="")}),e.searchVault=function(){t.go("backend.vault")},e.addSite=function(){e.$broadcast("vaultAddSite")},e.addFolder=function(){e.$broadcast("vaultAddFolder")},e.changeEmail=function(){e.$broadcast("settingsChangeEmail")},e.changePassword=function(){e.$broadcast("settingsChangePassword")},e.sessions=function(){e.$broadcast("settingsSessions")},e["delete"]=function(){e.$broadcast("settingsDelete")},e.twoFactor=function(){e.$broadcast("settingsTwoFactor")},e["import"]=function(){e.$broadcast("toolsImport")},e["export"]=function(){e.$broadcast("toolsExport")},e.audits=function(){e.$broadcast("toolsAudits")}}]),angular.module("bit.global").controller("sideNavController",["$scope","$state",function(e,t){e.$state=t}]),angular.module("bit.global").controller("topNavController",["$scope",function(e){}]),angular.module("bit.services").factory("apiService",["$resource","tokenService","appSettings",function(e,t,r){var o={},n=r.apiUri;return o.sites=e(n+"/sites/:id",{},{get:{method:"GET",params:{id:"@id"}},list:{method:"GET",params:{}},post:{method:"POST",params:{}},put:{method:"POST",params:{id:"@id"}},del:{url:n+"/sites/:id/delete",method:"POST",params:{id:"@id"}}}),o.folders=e(n+"/folders/:id",{},{get:{method:"GET",params:{id:"@id"}},list:{method:"GET",params:{}},post:{method:"POST",params:{}},put:{method:"POST",params:{id:"@id"}},del:{url:n+"/folders/:id/delete",method:"POST",params:{id:"@id"}}}),o.ciphers=e(n+"/ciphers/:id",{},{get:{method:"GET",params:{id:"@id"}},list:{method:"GET",params:{}},"import":{url:n+"/ciphers/import",method:"POST",params:{}},favorite:{url:n+"/ciphers/:id/favorite",method:"POST",params:{id:"@id"}},del:{url:n+"/ciphers/:id/delete",method:"POST",params:{id:"@id"}}}),o.accounts=e(n+"/accounts",{},{register:{url:n+"/accounts/register",method:"POST",params:{}},emailToken:{url:n+"/accounts/email-token",method:"POST",params:{}},email:{url:n+"/accounts/email",method:"POST",params:{}},putPassword:{url:n+"/accounts/password",method:"POST",params:{}},getProfile:{url:n+"/accounts/profile",method:"GET",params:{}},putProfile:{url:n+"/accounts/profile",method:"POST",params:{}},getTwoFactor:{url:n+"/accounts/two-factor",method:"GET",params:{}},putTwoFactor:{url:n+"/accounts/two-factor",method:"POST",params:{}},postTwoFactorRecover:{url:n+"/accounts/two-factor-recover",method:"POST",params:{}},postPasswordHint:{url:n+"/accounts/password-hint",method:"POST",params:{}},putSecurityStamp:{url:n+"/accounts/security-stamp",method:"POST",params:{}},"import":{url:n+"/accounts/import",method:"POST",params:{}},postDelete:{url:n+"/accounts/delete",method:"POST",params:{}}}),o.auth=e(n+"/auth",{},{token:{url:n+"/auth/token",method:"POST",params:{}},tokenTwoFactor:{url:n+"/auth/token/two-factor",method:"POST",params:{}}}),o}]),angular.module("bit.services").factory("authService",["cryptoService","apiService","tokenService","$q","jwtHelper",function(e,t,r,o,n){function a(e){i.extended={name:e.Name,twoFactorEnabled:e.TwoFactorEnabled,culture:e.Culture}}var s={},i=null;return s.logIn=function(n,a){n=n.toLowerCase();var i=e.makeKey(a,n),l={email:n,masterPasswordHash:e.hashPassword(a,i)},c=o.defer();return t.auth.token(l,function(t){t&&t.Token&&(r.setToken(t.Token),e.setKey(i),s.setUserProfile(t.Profile),c.resolve(t))},function(e){c.reject(e)}),c.promise},s.logInTwoFactor=function(e,n){var a={code:e.replace(" ",""),provider:n},i=o.defer();return t.auth.tokenTwoFactor(a,function(e){e&&e.Token&&(r.setToken(e.Token),s.setUserProfile(e.Profile),i.resolve(e))},function(e){i.reject(e)}),i.promise},s.logOut=function(){r.clearToken(),e.clearKey(),i=null},s.getUserProfile=function(){return i||s.setUserProfile(),i},s.setUserProfile=function(e){var o=r.getToken();if(o){var s=n.decodeToken(o),l="TwoFactor"===s.authmethod;i={id:s.nameid,email:s.email,twoFactor:l},!l&&e?a(e):l||e||t.accounts.getProfile({},a)}},s.isAuthenticated=function(){return null!==s.getUserProfile()&&!s.getUserProfile().twoFactor},s.isTwoFactorAuthenticated=function(){return null!==s.getUserProfile()&&s.getUserProfile().twoFactor},s}]),angular.module("bit.services").factory("cipherService",["cryptoService","apiService",function(e,t){var r={};return r.decryptSites=function(e){if(!e)throw"encryptedSites is undefined or null";for(var t=[],o=0;o<e.length;o++)t.push(r.decryptSite(e[o]));return t},r.decryptSite=function(t){if(!t)throw"encryptedSite is undefined or null";var r={id:t.Id,type:1,folderId:t.FolderId,favorite:t.Favorite,name:e.decrypt(t.Name),uri:t.Uri&&""!==t.Uri?e.decrypt(t.Uri):null,username:t.Username&&""!==t.Username?e.decrypt(t.Username):null,password:t.Password&&""!==t.Password?e.decrypt(t.Password):null,notes:t.Notes&&""!==t.Notes?e.decrypt(t.Notes):null};return t.Folder&&(r.folder={name:e.decrypt(t.Folder.Name)}),r},r.decryptFolders=function(e){if(!e)throw"encryptedFolders is undefined or null";for(var t=[],o=0;o<e.length;o++)t.push(r.decryptFolder(e[o]));return t},r.decryptFolder=function(t){if(!t)throw"encryptedFolder is undefined or null";return{id:t.Id,type:0,name:e.decrypt(t.Name)}},r.encryptSites=function(e,t){if(!e)throw"unencryptedSites is undefined or null";for(var o=[],n=0;n<e.length;n++)o.push(r.encryptSite(e[n],t));return o},r.encryptSite=function(t,r){if(!t)throw"unencryptedSite is undefined or null";return{id:t.id,type:1,folderId:""===t.folderId?null:t.folderId,favorite:null!==t.favorite?t.favorite:!1,uri:t.uri&&""!==t.uri?e.encrypt(t.uri,r):null,name:e.encrypt(t.name,r),username:t.username&&""!==t.username?e.encrypt(t.username,r):null,password:t.password&&""!==t.password?e.encrypt(t.password,r):null,notes:t.notes&&""!==t.notes?e.encrypt(t.notes,r):null}},r.encryptFolders=function(e,t){if(!e)throw"unencryptedFolders is undefined or null";for(var o=[],n=0;n<e.length;n++)o.push(r.encryptFolder(e[n],t));return o},r.encryptFolder=function(t,r){if(!t)throw"unencryptedFolder is undefined or null";return{id:t.id,type:0,name:e.encrypt(t.name,r)}},r}]),angular.module("bit.services").factory("cryptoService",["$sessionStorage",function(e){function t(e,t){"string"==typeof e&&(e=sjcl.codec.base64.toBits(e)),"string"==typeof t&&(t=sjcl.codec.base64.toBits(t));var r=s.getMacKey(),o=new sjcl.misc.hmac(r,sjcl.hash.sha256),n=t.concat(e),a=o.encrypt(n);return sjcl.codec.base64.fromBits(a)}var r,o,n,a,s={};return sjcl.beware["CBC mode is dangerous because it doesn't protect message integrity."](),s.setKey=function(t){r=t,e.key=sjcl.codec.base64.fromBits(t)},s.getKey=function(t){return t&&t===!0&&o?o:!t&&r?r:(e.key&&(r=sjcl.codec.base64.toBits(e.key)),t&&t===!0?o=sjcl.codec.base64.fromBits(r):r)},s.getEncKey=function(e){return e=e||s.getKey(),e.slice(0,4)},s.getMacKey=function(e){return e=e||s.getKey(),e.slice(4)},s.clearKey=function(){r=o=n=a=null,delete e.key},s.makeKey=function(e,t,r){var o=sjcl.misc.pbkdf2(e,t,5e3,256,null);return r&&r===!0?sjcl.codec.base64.fromBits(o):o},s.hashPassword=function(e,t){if(t||(t=s.getKey()),!e||!t)throw"Invalid parameters.";var r=sjcl.misc.pbkdf2(t,e,1,256,null);return sjcl.codec.base64.fromBits(r)},s.getAes=function(){return!n&&s.getKey()&&(n=new sjcl.cipher.aes(s.getKey())),n},s.getAesWithMac=function(){return!a&&s.getKey()&&(a=new sjcl.cipher.aes(s.getEncKey())),a},s.encrypt=function(e,t){if(!s.getKey()&&!t)throw"Encryption key unavailable.";var r=null;r=t||s.getKey();var o={},n={mode:"cbc",iv:sjcl.random.randomWords(4,10)},a=sjcl.encrypt(r,e,n,o),i=a.match(/"ct":"([^"]*)"/)[1],l=sjcl.codec.base64.fromBits(o.iv),c=l+"|"+i;return c},s.decrypt=function(e){if(!s.getAes()||!s.getAesWithMac())throw"AES encryption unavailable.";var r=e.split("|");if(2!==r.length&&3!==r.length)return"";var o=sjcl.codec.base64.toBits(r[0]),n=sjcl.codec.base64.toBits(r[1]),a=null;if(3===r.length&&(a=t(n,o),a!==r[2]))return console.error("MAC failed."),"";var i=sjcl.mode.cbc.decrypt(a?s.getAesWithMac():s.getAes(),n,o,null);return sjcl.codec.utf8String.fromBits(i)},s}]),angular.module("bit.services").factory("importService",function(){function e(e){return e.length>1e3?e.substring(0,1e3):e}function t(e){if(e.errors&&e.errors.length)for(var t=0;t<e.errors.length;t++)console.warn("Error parsing row "+e.errors[t].row+": "+e.errors[t].message)}function r(r,o,n){Papa.parse(r,{header:!0,encoding:"UTF-8",complete:function(r){t(r);var n=[],a=[],s=[];angular.forEach(r.data,function(t,r){var o=n.length,i=a.length,l=t.folder&&""!==t.folder,c=l;if(l)for(var u=0;u<n.length;u++)if(n[u].name===t.folder){c=!1,o=u;break}if(a.push({favorite:null!==t.favorite?t.favorite:!1,uri:t.uri&&""!==t.uri?e(t.uri):null,username:t.username&&""!==t.username?t.username:null,password:t.password&&""!==t.password?t.password:null,notes:t.notes&&""!==t.notes?t.notes:null,name:t.name&&""!==t.name?t.name:"--"}),c&&n.push({name:t.folder}),l){var d={key:i,value:o};s.push(d)}}),o(n,a,s)}})}function o(r,o,n){function a(t){var r=[],a=[],s=[],i=0;angular.forEach(t,function(t,o){var n=r.length,l=a.length,c=t.grouping&&""!==t.grouping&&"(none)"!==t.grouping,u=c;if(c)for(var d=0;d<r.length;d++)if(r[d].name===t.grouping){u=!1,n=d;break}if(t.name&&""!==t.name||t.password&&""!==t.password||i++,a.push({favorite:"1"===t.fav,uri:t.url&&""!==t.url?e(t.url):null,username:t.username&&""!==t.username?t.username:null,password:t.password&&""!==t.password?t.password:null,notes:t.extra&&""!==t.extra?t.extra:null,name:t.name&&""!==t.name?t.name:"--"}),u&&r.push({name:t.grouping}),c){var p={key:l,value:n};s.push(p)}}),i&&i>t.length/2?n("CSV data is not formatted correctly from LastPass. Please check your import file and try again."):o(r,a,s)}if("text/html"===r.type){var s=new FileReader;s.readAsText(r,"utf-8"),s.onload=function(e){var t,r,o=$(e.target.result),s=o.find("pre");if(1===s.length)t=s.text().trim(),r=Papa.parse(t,{header:!0,encoding:"UTF-8"}),a(r.data);else{for(var i=!1,l=0;l<o.length;l++)if("pre"===o[l].tagName.toLowerCase()){i=!0,t=o[l].outerText.trim(),r=Papa.parse(t,{header:!0,encoding:"UTF-8"}),a(r.data);break}i||n()}},s.onerror=function(e){n()}}else Papa.parse(r,{header:!0,encoding:"UTF-8",complete:function(e){t(e),a(e.data)}})}function n(r,o,n){Papa.parse(r,{header:!0,encoding:"UTF-8",complete:function(r){t(r);var n=[],a=[],s=[];angular.forEach(r.data,function(t,r){a.push({favorite:!1,uri:t.URL&&""!==t.URL?e(t.URL):null,username:t.Login&&""!==t.Login?t.Login:null,password:t.Password&&""!==t.Password?t.Password:null,notes:t.Notes&&""!==t.Notes?t.Notes:null,name:t.Title&&""!==t.Title?t.Title:"--"})}),o(n,a,s)}})}function a(t,r,o){var n=[],a=[],s=[],i=[],l=0,c=0,u=new FileReader;u.readAsText(t,"utf-8"),u.onload=function(t){var u=$.parseXML(t.target.result),d=$(u),p=d.find("database");if(p.length){var f=p.find("> label");if(f.length)for(l=0;l<f.length;l++){var m=$(f[l]);i[m.attr("id")]=n.length,n.push({name:m.attr("name")})}var g=p.find("> card");if(g.length)for(l=0;l<g.length;l++){var v=$(g[l]);if("true"!==v.attr("template")){var h={favorite:!1,uri:null,username:null,password:null,notes:null,name:v.attr("title")},w=v.find("> field");for(c=0;c<w.length;c++){var y=$(w[c]),b=y.text(),S=y.attr("type");b&&""!==b&&("login"===S?h.username=b:"password"===S?h.password=b:"notes"===S?h.notes=b:"website"===S&&(h.uri=e(b)))}if(a.push(h),f=v.find("> label_id"),f.length){var P=$(f[0]).text(),k=i[P];null!==P&&""!==P&&null!==k&&s.push({key:a.length-1,value:k})}}}r(n,a,s)}else o()},u.onerror=function(e){o()}}function s(r,o,n){Papa.parse(r,{encoding:"UTF-8",complete:function(r){t(r);var n=[],a=[],s=[],i=[],l=0,c=0;for(l=0;l<r.data.length;l++){var u=r.data[l];if(0!==l){var d=n.length,p=a.length,f=u[1]&&""!==u[1],m=f;if(f)for(c=0;c<n.length;c++)if(n[c].name===u[1]){m=!1,d=c;break}var g={favorite:!1,uri:null,username:u[2]&&""!==u[2]?u[2]:null,password:u[3]&&""!==u[3]?u[3]:null,notes:null,name:u[0]&&""!==u[0]?u[0]:"--"};if(i.length)for(c=4;c<u.length;c++){var v=u[c];if(v&&""!==v){var h=i[c-4];"url"===h.toLowerCase()||"uri"===h.toLowerCase()?g.uri=e(v):(null===g.notes&&(g.notes=""),g.notes+=h+": "+v+"\n")}}a.push(g),m&&n.push({name:u[1]}),f&&s.push({key:p,value:d})}else for(c=4;c<u.length;c++)i.push(u[c])}o(n,a,s)}})}function i(t,r,o){function n(t,r,o){var l=a.length,c=o;r||(""!==c&&(c+=" > "),c+=t.find("> Name").text(),a.push({name:c}));var u=t.find("> Entry");if(u.length)for(var d=0;d<u.length;d++){for(var p=$(u[d]),f=s.length,m={favorite:!1,uri:null,username:null,password:null,notes:null,name:null},g=p.find("> String"),v=0;v<g.length;v++){var h=$(g[v]),w=h.find("> Key").text(),y=h.find("> Value").text();if(""!==y)switch(w){case"URL":m.uri=e(y);break;case"UserName":m.username=y;break;case"Password":m.password=y;break;case"Title":m.name=y;break;case"Notes":m.notes=null===m.notes?y+"\n":m.notes+y+"\n";break;default:m.notes=null===m.notes?w+": "+y+"\n":m.notes+w+": "+y+"\n"}}null===m.name&&(m.name="--"),s.push(m),r||i.push({key:f,value:l})}var b=t.find("> Group");if(b.length)for(var S=0;S<b.length;S++)n($(b[S]),!1,c)}var a=[],s=[],i=[],l=new FileReader;l.readAsText(t,"utf-8"),l.onload=function(e){var t=$.parseXML(e.target.result),l=$(t),c=l.find("Root");if(c.length){var u=c.find("> Group");u.length&&(n($(u[0]),!0,""),r(a,s,i))}else o()},l.onerror=function(e){o()}}function l(t,r,o){var n=[],a=[],s=[],i=0,l=0,c=new FileReader;c.readAsText(t,"utf-8"),c.onload=function(t){var o=t.target.result,c=o.split(/(?:\r\n|\r|\n)/);for(i=0;i<c.length;i++){var u=c[i];if(u.length&&"{"===u[0]){var d=JSON.parse(u);if("webforms.WebForm"===d.typeName){var p={favorite:!(!d.openContents||!d.openContents.faveIndex),uri:d.location&&""!==d.location?e(d.location):null,username:null,password:null,notes:null,name:d.title&&""!==d.title?d.title:"--"};if(d.secureContents&&(d.secureContents.notesPlain&&""!==d.secureContents.notesPlain&&(p.notes=d.secureContents.notesPlain),d.secureContents.fields))for(l=0;l<d.secureContents.fields.length;l++){var f=d.secureContents.fields[l];"username"===f.designation?p.username=f.value:"password"===f.designation?p.password=f.value:(null===p.notes?p.notes="":p.notes+="\n",p.notes+=f.name+": "+f.value+"\n")}a.push(p)}}}r(n,a,s)},c.onerror=function(e){o()}}function c(r,o,n){Papa.parse(r,{header:!0,encoding:"UTF-8",complete:function(r){t(r);var n=[],a=[],s=[];angular.forEach(r.data,function(t,r){a.push({favorite:!1,uri:t.url&&""!==t.url?e(t.url):null,username:t.username&&""!==t.username?t.username:null,password:t.password&&""!==t.password?t.password:null,notes:null,name:t.name&&""!==t.name?t.name:"--"})}),o(n,a,s)}})}function u(t,r,o){function n(e){var t="--";try{if(e&&""!==e){var r=document.createElement("a");r.href=e,r.hostname&&(t=r.hostname)}}catch(o){}return t}var a=[],s=[],i=[];if("text/xml"!==t.type)return void o("Only .xml exports are supported.");var l=new FileReader;l.readAsText(t,"utf-8"),l.onload=function(t){for(var o=$.parseXML(t.target.result),l=$(o),c=l.find("entry"),u=0;u<c.length;u++){var d=$(c[u]);if(d){var p=d.attr("host"),f=d.attr("user"),m=d.attr("password");s.push({favorite:!1,uri:p&&""!==p?e(p):null,username:f&&""!==f?f:null,password:m&&""!==m?m:null,notes:null,name:n(p)})}}r(a,s,i)},l.onerror=function(e){o()}}function d(r,o,n){Papa.parse(r,{encoding:"UTF-8",complete:function(r){t(r);var n=[],a=[],s=[];angular.forEach(r.data,function(t,r){5===t.length&&a.push({favorite:!1,uri:t[3]&&""!==t[3]?e(t[3]):null,username:t[1]&&""!==t[1]?t[1]:null,password:t[2]&&""!==t[2]?t[2]:null,notes:t[4]&&""!==t[4]?t[4]:null,name:t[0]&&""!==t[0]?t[0]:"--"})}),o(n,a,s)}})}function p(r,o,n){Papa.parse(r,{encoding:"UTF-8",complete:function(r){t(r);var n=[],a=[],s=[];angular.forEach(r.data,function(t,r){if(t.length>=6){var o=n.length,i=a.length,l=t[0]&&""!==t[0],c=l,u=0;if(l)for(u=0;u<n.length;u++)if(n[u].name===t[0]){c=!1,o=u;break}var d={favorite:!1,uri:t[4]&&""!==t[4]?e(t[4]):null,username:t[2]&&""!==t[2]?t[2]:null,password:t[3]&&""!==t[3]?t[3]:null,notes:t[5]&&""!==t[5]?t[5]:null,name:t[1]&&""!==t[1]?t[1]:"--"};if(t.length>6)for(null===d.notes?d.notes="":d.notes+="\n",u=6;u<t.length;u+=2){var p=t[u],f=t[u+1];d.notes+=p+": "+f+"\n"}if(a.push(d),c&&n.push({name:t[0]}),l){var m={key:i,value:o};s.push(m)}}}),o(n,a,s)}})}function f(t,r,o){var n=[],a=[],s=[],i=0,l=new FileReader;l.readAsText(t,"utf-8"),l.onload=function(t){var l=$.parseXML(t.target.result),c=$(l),u=c.find("PasswordManager");if(u.length){var d=u.find("> record");if(d.length)for(var p=0;p<d.length;p++){var f=$(d[p]),m=f.find("> Account-Name"),g=m.length?$(m):null,v=f.find("> User-Id"),h=v.length?$(v):null,w=f.find("> Password"),y=w.length?$(w):null,b=f.find("> URL"),S=b.length?$(b):null,P=f.find("> Notes"),k=P.length?$(P):null,T=f.find("> Category"),C=T.length?$(T):null,F=C?C.text():null,E=n.length,x=a.length,M=F&&""!==F&&"Unfiled"!==F,U=M;if(M)for(i=0;i<n.length;i++)if(n[i].name===F){U=!1,E=i;break}var A={favorite:!1,uri:S&&""!==S.text()?e(S.text()):null,username:h&&""!==h.text()?h.text():null,password:y&&""!==y.text()?y.text():null,notes:k&&""!==k.text()?k.text():null,name:g&&""!==g.text()?g.text():"--"},L="";for(i=1;10>=i;i++)L+="> Attribute-"+i,10>i&&(L+=", ");var I=f.find(L);if(I.length)for(i=0;i<I.length;i++){var O=$(I[i]),N=O.prop("tagName"),D=O.text();D&&""!==D&&"null"!==D&&(null===A.notes?A.notes="":A.notes+="\n",A.notes+=N+": "+D)}if(a.push(A),U&&n.push({name:F}),M){var j={key:x,value:E};s.push(j)}}r(n,a,s)}else o()},l.onerror=function(e){o()}}function m(r,o,n){Papa.parse(r,{encoding:"UTF-8",complete:function(r){t(r);for(var n=[],a=[],s=[],i=0;i<r.data.length;i++){var l=r.data[i];if(!(l.length<2||0===i&&"Title"===l[0])){var c=l[l.length-1],u={name:l[0],favorite:!1,uri:null,password:null,username:null,notes:c&&""!==c?c:null};if(l.length>2&&l.length%2===0)for(var d=0;d<l.length-2;d+=2){var p=l[d+2];if(p&&""!==p){var f=l[d+1],m=f.toLowerCase();"url"!==m||u.uri?"username"!==m&&"email"!==m||u.username?"password"!==m||u.password?u.notes=null===u.notes?f+": "+p:u.notes+"\n"+f+": "+p:u.password=p:u.username=p:u.uri=e(p)}}a.push(u)}}o(n,a,s)}})}function g(t,r,o){var n=[],a=[],s=[],i=0,l=new FileReader;l.readAsText(t,"utf-8"),l.onload=function(t){var l=$.parseXML(t.target.result),c=$(l),u=c.find("passwordsafe");if(u.length){var d=u.attr("delimiter"),p=u.find("> entry");if(p.length)for(var f=0;f<p.length;f++){var m=$(p[f]),g=m.find("> title"),v=g.length?$(g):null,h=m.find("> username"),w=h.length?$(h):null,y=m.find("> email"),b=y.length?$(y):null,S=b?b.text():null,P=m.find("> password"),k=P.length?$(P):null,T=m.find("> url"),C=T.length?$(T):null,F=m.find("> notes"),E=F.length?$(F):null,x=E?E.text().split(d).join("\n"):null,M=m.find("> group"),U=M.length?$(M):null,A=U?U.text().split(".").join(" > "):null,L=n.length,I=a.length,O=A&&""!==A,N=O;if(O)for(i=0;i<n.length;i++)if(n[i].name===A){N=!1,L=i;break}var D={favorite:!1,uri:C&&""!==C.text()?e(C.text()):null,username:w&&""!==w.text()?w.text():null,password:k&&""!==k.text()?k.text():null,notes:E&&""!==x?x:null,name:v&&""!==v.text()?v.text():"--"};if(!D.username&&S&&""!==S?D.username=S:S&&""!==S&&(D.notes=null===D.notes?"Email: "+S:D.notes+"\nEmail: "+S),a.push(D),N&&n.push({name:A}),O){var j={key:I,value:L};s.push(j)}}r(n,a,s)}else o()},l.onerror=function(e){o()}}function v(r,o,n){Papa.parse(r,{encoding:"UTF-8",complete:function(r){t(r);for(var n=[],a=[],s=[],i=0;i<r.data.length;i++){var l=!1,c=r.data[i];if(c.length&&1!==c.length){var u={name:c[0]&&""!==c[0]?c[0]:"--",favorite:!1,uri:null,password:null,username:null,notes:null};if(2===c.length)u.uri=e(c[1]);else if(3===c.length)u.uri=e(c[1]),u.username=c[2];else if(4===c.length)""===c[2]&&""===c[3]?(u.username=c[1],u.notes=c[2]+"\n"+c[3]):(u.username=c[2],u.notes=c[1]+"\n"+c[3]);else if(5===c.length)u.uri=e(c[1]),u.username=c[2],u.password=c[3],u.notes=c[4];else if(6===c.length)""===c[2]?(u.username=c[3],u.notes=c[5]):(u.username=c[2],u.notes=c[3]+"\n"+c[5]),u.uri=e(c[1]),u.password=c[4];else if(7===c.length)""===c[2]?(u.username=c[3],u.notes=c[4]+"\n"+c[6]):(u.username=c[2],u.notes=c[3]+"\n"+c[4]+"\n"+c[6]),u.uri=e(c[1]),u.password=c[5];else{u.notes="";for(var d=1;d<c.length;d++)if(u.notes=u.notes+c[d]+"\n","NO_TYPE"===c[d]){l=!0;break}}u.uri&&u.uri.indexOf(".")>=0&&(u.uri="http://"+u.uri.toLowerCase().trim()),l||(""===u.username&&(u.username=null),""===u.password&&(u.password=null),""===u.notes&&(u.notes=null),""===u.uri&&(u.uri=null),a.push(u))}}o(n,a,s)}})}var h={};return h["import"]=function(e,t,h,w){if(!t)return void w();switch(e){case"local":r(t,h,w);break;case"lastpass":o(t,h,w);break;case"safeincloudcsv":n(t,h,w);break;case"safeincloudxml":a(t,h,w);break;case"keypassxml":i(t,h,w);break;case"padlockcsv":s(t,h,w);break;case"1password1pif":l(t,h,w);break;case"chromecsv":c(t,h,w);break;case"firefoxpasswordexportercsvxml":u(t,h,w);break;case"upmcsv":d(t,h,w);break;case"keepercsv":p(t,h,w);break;case"passworddragonxml":f(t,h,w);break;case"enpasscsv":m(t,h,w);break;case"pwsafexml":g(t,h,w);break;case"dashlanecsv":v(t,h,w);break;default:w()}},h}),angular.module("bit.services").factory("passwordService",function(){function e(t,r){var o=0,n=r-t,a=Math.ceil(Math.log2(n));if(a>53)throw new Exception("We cannot generate numbers larger than 53 bits.");var s=Math.ceil(a/8),i=Math.pow(2,a)-1,l=new Uint8Array(s);
window.crypto.getRandomValues(l);for(var c=8*(s-1),u=0;s>u;u++)o+=l[u]*Math.pow(2,c),c-=8;return o&=i,o>=n?e(t,r):t+o}var t={};return t.generatePassword=function(t){var r={length:10,ambiguous:!1,number:!0,minNumber:1,uppercase:!0,minUppercase:1,lowercase:!0,minLowercase:1,special:!1,minSpecial:1},o=angular.extend({},r,t);o.uppercase&&o.minUppercase<0&&(o.minUppercase=1),o.lowercase&&o.minLowercase<0&&(o.minLowercase=1),o.number&&o.minNumber<0&&(o.minNumber=1),o.special&&o.minSpecial<0&&(o.minSpecial=1),(!o.length||o.length<1)&&(o.length=10);var n=o.minUppercase+o.minLowercase+o.minNumber+o.minSpecial;o.length<n&&(o.length=n);var a=[];if(o.lowercase&&o.minLowercase>0)for(var s=0;s<o.minLowercase;s++)a.push("l");if(o.uppercase&&o.minUppercase>0)for(var i=0;i<o.minUppercase;i++)a.push("u");if(o.number&&o.minNumber>0)for(var l=0;l<o.minNumber;l++)a.push("n");if(o.special&&o.minSpecial>0)for(var c=0;c<o.minSpecial;c++)a.push("s");for(;a.length<o.length;)a.push("a");a.sort(function(){return 2*e(0,1)-1});var u="",d="abcdefghijkmnopqrstuvwxyz";o.ambiguous&&(d+="l"),o.lowercase&&(u+=d);var p="ABCDEFGHIJKLMNPQRSTUVWXYZ";o.ambiguous&&(p+="O"),o.uppercase&&(u+=p);var f="23456789";o.ambiguous&&(f+="01"),o.number&&(u+=f);var m="!@#$%^&*";o.special&&(u+=m);for(var g="",v=0;v<o.length;v++){var h;switch(a[v]){case"l":h=d;break;case"u":h=p;break;case"n":h=f;break;case"s":h=m;break;case"a":h=u}var w=e(0,h.length-1);g+=h.charAt(w)}return g},t}),angular.module("bit.services").factory("tokenService",["$sessionStorage",function(e){var t,r={};return r.setToken=function(r){e.authBearer=r,t=r},r.getToken=function(){return t||(t=e.authBearer),t},r.clearToken=function(){t=null,delete e.authBearer},r}]),angular.module("bit.services").factory("validationService",function(){var e={};return e.addErrors=function(t,r){var o=r.data,n="An unexpected error has occured.";if(t.$errors=[],!o||!angular.isObject(o))return void t.$errors.push(n);if(!o.ValidationErrors)return void(o.Message?t.$errors.push(o.Message):t.$errors.push(n));for(var a in o.ValidationErrors)if(o.ValidationErrors.hasOwnProperty(a))for(var s=0;s<o.ValidationErrors[a].length;s++)e.addError(t,a,o.ValidationErrors[a][s])},e.addError=function(e,t,r,o){!o&&e.$errors||(e.$errors=[]);for(var n=!0,a=0;a<e.$errors.length;a++)if(e.$errors[a]===r){n=!1;break}n&&e.$errors.push(r),t&&""!==t&&e[t]&&e[t].$registerApiError&&e[t].$registerApiError()},e}),angular.module("bit.settings").controller("settingsChangeEmailController",["$scope","$state","apiService","$uibModalInstance","cryptoService","cipherService","authService","$q","toastr","$analytics",function(e,t,r,o,n,a,s,i,l,c){c.eventTrack("settingsChangeEmailController",{category:"Modal"});var u,d,p;e.token=function(t){u=n.hashPassword(t.masterPassword);var o=t.newEmail.toLowerCase(),a={newEmail:o,masterPasswordHash:u};e.tokenPromise=r.accounts.emailToken(a,function(){p=n.makeKey(t.masterPassword,o),d=n.hashPassword(t.masterPassword,p),e.tokenSent=!0}).$promise},e.confirm=function(n){e.processing=!0;var f=[],m=r.sites.list({dirty:!1},function(e){var t=a.decryptSites(e.Data);f=a.encryptSites(t,p)}).$promise,g=[],v=r.folders.list({dirty:!1},function(e){var t=a.decryptFolders(e.Data);g=a.encryptFolders(t,p)}).$promise;i.all([m,v]).then(function(){var a={token:n.token,newEmail:n.newEmail.toLowerCase(),masterPasswordHash:u,newMasterPasswordHash:d,ciphers:f.concat(g)};e.confirmPromise=r.accounts.email(a,function(){o.dismiss("cancel"),c.eventTrack("Changed Email"),s.logOut(),t.go("frontend.login.info").then(function(){l.success("Please log back in.","Email Changed")})},function(){o.dismiss("cancel"),l.error("Something went wrong.","Oh No!")}).$promise})},e.close=function(){o.dismiss("cancel")}}]),angular.module("bit.settings").controller("settingsChangePasswordController",["$scope","$state","apiService","$uibModalInstance","cryptoService","authService","cipherService","validationService","$q","toastr","$analytics",function(e,t,r,o,n,a,s,i,l,c,u){u.eventTrack("settingsChangePasswordController",{category:"Modal"}),e.save=function(d,p){var f=!1;if(e.model.newMasterPassword.length<8&&(i.addError(p,"NewMasterPasswordHash","Master password must be at least 8 characters long.",!0),f=!0),e.model.newMasterPassword!==e.model.confirmNewMasterPassword&&(i.addError(p,"ConfirmNewMasterPasswordHash","New master password confirmation does not match.",!0),f=!0),!f){e.processing=!0;var m=a.getUserProfile(),g=n.makeKey(d.newMasterPassword,m.email.toLowerCase()),v=[],h=r.sites.list({dirty:!1},function(e){var t=s.decryptSites(e.Data);v=s.encryptSites(t,g)}).$promise,w=[],y=r.folders.list({dirty:!1},function(e){var t=s.decryptFolders(e.Data);w=s.encryptFolders(t,g)}).$promise;l.all([h,y]).then(function(){var s={masterPasswordHash:n.hashPassword(d.masterPassword),newMasterPasswordHash:n.hashPassword(d.newMasterPassword,g),ciphers:v.concat(w)};e.savePromise=r.accounts.putPassword(s,function(){o.dismiss("cancel"),a.logOut(),u.eventTrack("Changed Password"),t.go("frontend.login.info").then(function(){c.success("Please log back in.","Master Password Changed")})},function(){o.dismiss("cancel"),c.error("Something went wrong.","Oh No!")}).$promise})}},e.close=function(){o.dismiss("cancel")}}]),angular.module("bit.settings").controller("settingsController",["$scope","$uibModal","apiService","toastr","authService",function(e,t,r,o,n){e.model={},r.accounts.getProfile({},function(t){e.model={name:t.Name,email:t.Email,masterPasswordHint:t.MasterPasswordHint,culture:t.Culture,twoFactorEnabled:t.TwoFactorEnabled}}),e.save=function(t){e.savePromise=r.accounts.putProfile({},t,function(e){n.setUserProfile(e),o.success("Account has been updated.","Success!")}).$promise},e.changePassword=function(){t.open({animation:!0,templateUrl:"app/settings/views/settingsChangePassword.html",controller:"settingsChangePasswordController"})},e.$on("settingsChangePassword",function(t,r){e.changePassword()}),e.changeEmail=function(){t.open({animation:!0,templateUrl:"app/settings/views/settingsChangeEmail.html",controller:"settingsChangeEmailController",size:"sm"})},e.$on("settingsChangeEmail",function(t,r){e.changeEmail()}),e.twoFactor=function(){t.open({animation:!0,templateUrl:"app/settings/views/settingsTwoFactor.html",controller:"settingsTwoFactorController"})},e.$on("settingsTwoFactor",function(t,r){e.twoFactor()}),e.sessions=function(){t.open({animation:!0,templateUrl:"app/settings/views/settingsSessions.html",controller:"settingsSessionsController"})},e.$on("settingsSessions",function(t,r){e.sessions()}),e["delete"]=function(){t.open({animation:!0,templateUrl:"app/settings/views/settingsDelete.html",controller:"settingsDeleteController",size:"sm"})},e.$on("settingsDelete",function(t,r){e["delete"]()})}]),angular.module("bit.settings").controller("settingsDeleteController",["$scope","$state","apiService","$uibModalInstance","cryptoService","authService","toastr","$analytics",function(e,t,r,o,n,a,s,i){i.eventTrack("settingsDeleteController",{category:"Modal"}),e.submit=function(l){var c={masterPasswordHash:n.hashPassword(l.masterPassword)};e.submitPromise=r.accounts.postDelete(c,function(){o.dismiss("cancel"),a.logOut(),i.eventTrack("Deleted Account"),t.go("frontend.login.info").then(function(){s.success("Your account has been closed and all associated data has been deleted.","Account Deleted")})}).$promise},e.close=function(){o.dismiss("cancel")}}]),angular.module("bit.settings").controller("settingsSessionsController",["$scope","$state","apiService","$uibModalInstance","cryptoService","authService","toastr","$analytics",function(e,t,r,o,n,a,s,i){i.eventTrack("settingsSessionsController",{category:"Modal"}),e.submit=function(l){var c={masterPasswordHash:n.hashPassword(l.masterPassword)};e.submitPromise=r.accounts.putSecurityStamp(c,function(){o.dismiss("cancel"),a.logOut(),i.eventTrack("Deauthorized Sessions"),t.go("frontend.login.info").then(function(){s.success("Please log back in.","All Sessions Deauthorized")})}).$promise},e.close=function(){o.dismiss("cancel")}}]),angular.module("bit.settings").controller("settingsTwoFactorController",["$scope","apiService","$uibModalInstance","cryptoService","authService","$q","toastr","$analytics",function(e,t,r,o,n,a,s,i){function l(e){return e?e.replace(/(.{4})/g,"$1 ").trim().toUpperCase():null}function c(t){var r=t.AuthenticatorKey;e.twoFactorModel={enabled:t.TwoFactorEnabled,key:l(r),recovery:l(t.TwoFactorRecoveryCode),qr:"https://chart.googleapis.com/chart?chs=120x120&chld=L|0&cht=qr&chl=otpauth://totp/"+d+":"+encodeURIComponent(p.email)+"%3Fsecret="+encodeURIComponent(r)+"%26issuer="+d}}i.eventTrack("settingsTwoFactorController",{category:"Modal"});var u,d="bitwarden",p=n.getUserProfile();e.account=p.email,e.enabled=function(){return p.extended&&p.extended.twoFactorEnabled},e.auth=function(r){u=o.hashPassword(r.masterPassword),e.authPromise=t.accounts.getTwoFactor({masterPasswordHash:u,provider:0},function(e){c(e)}).$promise},e.update=function(r){var o=e.twoFactorModel.enabled;if(!o||confirm("Are you sure you want to disable two-step login?")){var n={enabled:!o,token:r.token.replace(" ",""),masterPasswordHash:u};e.updatePromise=t.accounts.putTwoFactor({},n,function(t){t.TwoFactorEnabled?(i.eventTrack("Enabled Two-step Login"),s.success("Two-step login has been enabled."),p.extended&&(p.extended.twoFactorEnabled=!0),c(t),$("#token").blur(),r.token=null):(i.eventTrack("Disabled Two-step Login"),s.success("Two-step login has been disabled."),p.extended&&(p.extended.twoFactorEnabled=!1),e.close())}).$promise}},e.close=function(){r.dismiss("cancel")}}]),angular.module("bit.tools").controller("toolsAuditsController",["$scope","apiService","$uibModalInstance","toastr","$analytics",function(e,t,r,o,n){n.eventTrack("toolsAuditsController",{category:"Modal"}),e.close=function(){r.dismiss("cancel")}}]),angular.module("bit.tools").controller("toolsController",["$scope","$uibModal","apiService","toastr","authService",function(e,t,r,o,n){e["import"]=function(){t.open({animation:!0,templateUrl:"app/tools/views/toolsImport.html",controller:"toolsImportController",size:"sm"})},e.$on("toolsImport",function(t,r){e["import"]()}),e["export"]=function(){t.open({animation:!0,templateUrl:"app/tools/views/toolsExport.html",controller:"toolsExportController",size:"sm"})},e.$on("toolsExport",function(t,r){e["export"]()}),e.audits=function(){t.open({animation:!0,templateUrl:"app/tools/views/toolsAudits.html",controller:"toolsAuditsController"})},e.$on("toolsAudits",function(t,r){e.audits()})}]),angular.module("bit.tools").controller("toolsExportController",["$scope","apiService","authService","$uibModalInstance","cryptoService","cipherService","$q","toastr","$analytics",function(e,t,r,o,n,a,s,i,l){function c(){var e=new Date,t=e.getFullYear()+""+u(e.getMonth()+1,2)+u(e.getDate(),2)+u(e.getHours(),2)+u(e.getMinutes(),2)+u(e.getSeconds(),2);return"bitwarden_export_"+t+".csv"}function u(e,t,r){return r=r||"0",e+="",e.length>=t?e:new Array(t-e.length+1).join(r)+e}l.eventTrack("toolsExportController",{category:"Modal"}),e["export"]=function(r){e.startedExport=!0,t.sites.list({expand:["folder"]},function(t){try{for(var r=a.decryptSites(t.Data),o=[],n=0;n<r.length;n++){var s={name:r[n].name,uri:r[n].uri,username:r[n].username,password:r[n].password,notes:r[n].notes,folder:r[n].folder?r[n].folder.name:null};o.push(s)}var u=Papa.unparse(o),d=new Blob([u]);if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(d,c());else{var p=window.document.createElement("a");p.href=window.URL.createObjectURL(d,{type:"text/plain"}),p.download=c(),document.body.appendChild(p),p.click(),document.body.removeChild(p)}l.eventTrack("Exported Data"),i.success("Your data has been exported. Check your browser's downloads folder.","Success!"),e.close()}catch(f){i.error("Something went wrong. Please try again.","Error!"),e.close()}},function(){i.error("Something went wrong. Please try again.","Error!"),e.close()})},e.close=function(){o.dismiss("cancel")}}]),angular.module("bit.tools").controller("toolsImportController",["$scope","$state","apiService","$uibModalInstance","cryptoService","cipherService","toastr","importService","$analytics",function(e,t,r,o,n,a,s,i,l){function c(i,c,d){return i.length||c.length?void r.ciphers["import"]({folders:a.encryptFolders(i,n.getKey()),sites:a.encryptSites(c,n.getKey()),folderRelationships:d},function(){o.dismiss("cancel"),t.go("backend.vault").then(function(){l.eventTrack("Imported Data",{label:e.model.source}),s.success("Data has been successfully imported into your vault.","Import Success")})},u):(o.dismiss("cancel"),void s.error("Nothing was imported."))}function u(t){if(l.eventTrack("Import Data Failed",{label:e.model.source}),o.dismiss("cancel"),t){var r=t.data;if(!r||!r.ValidationErrors)return r&&r.Message?void s.error(r.Message):void s.error(t);var n="";for(var a in r.ValidationErrors)if(r.ValidationErrors.hasOwnProperty(a))for(var i=0;i<r.ValidationErrors[a].length;i++)n+=a+": "+r.ValidationErrors[a][i]+" ";if(""!==n)return void s.error(n)}s.error("Something went wrong. Try again.","Oh No!")}l.eventTrack("toolsImportController",{category:"Modal"}),e.model={source:"local"},e["import"]=function(t){e.processing=!0;var r=document.getElementById("file").files[0];i["import"](t.source,r,c,u)},e.close=function(){o.dismiss("cancel")}}]),angular.module("bit.vault").controller("vaultAddFolderController",["$scope","apiService","$uibModalInstance","cryptoService","cipherService","$analytics",function(e,t,r,o,n,a){a.eventTrack("vaultAddFolderController",{category:"Modal"}),e.savePromise=null,e.save=function(o){var s=n.encryptFolder(o);e.savePromise=t.folders.post(s,function(e){a.eventTrack("Created Folder");var t=n.decryptFolder(e);r.close(t)}).$promise},e.close=function(){r.dismiss("close")}}]),angular.module("bit.vault").controller("vaultAddSiteController",["$scope","apiService","$uibModalInstance","cryptoService","cipherService","passwordService","folders","selectedFolder","$analytics",function(e,t,r,o,n,a,s,i,l){function c(e){var t=$(e.trigger).parent().prev();"text"===t.attr("type")&&t.select()}l.eventTrack("vaultAddSiteController",{category:"Modal"}),e.folders=s,e.site={folderId:i?i.id:null},e.savePromise=null,e.save=function(o){var a=n.encryptSite(o);e.savePromise=t.sites.post(a,function(e){l.eventTrack("Created Site");var t=n.decryptSite(e);r.close(t)}).$promise},e.generatePassword=function(){e.site.password&&!confirm("Are you sure you want to overwrite the current password?")||(l.eventTrack("Generated Password From Add"),e.site.password=a.generatePassword({length:10,special:!0}))},e.clipboardSuccess=function(e){e.clearSelection(),c(e)},e.clipboardError=function(e,t){t&&c(e),alert("Your web browser does not support easy clipboard copying. Copy it manually instead.")},e.folderSort=function(e){return e.name.toLowerCase()},e.close=function(){r.dismiss("close")}}]),angular.module("bit.vault").controller("vaultController",["$scope","$uibModal","apiService","$filter","cryptoService","authService","toastr","cipherService",function(e,t,r,o,n,a,s,i){e.sites=[],e.folders=[],e.loadingSites=!0,r.sites.list({},function(t){e.loadingSites=!1;for(var r=[],o=0;o<t.Data.length;o++){var a={id:t.Data[o].Id,folderId:t.Data[o].FolderId,favorite:t.Data[o].Favorite};try{a.name=n.decrypt(t.Data[o].Name)}catch(s){a.name="[error: cannot decrypt]"}if(t.Data[o].Username)try{a.username=n.decrypt(t.Data[o].Username)}catch(s){a.username="[error: cannot decrypt]"}r.push(a)}e.sites=r},function(){e.loadingSites=!1}),e.loadingFolders=!0,r.folders.list({},function(t){e.loadingFolders=!1;for(var r=[{id:null,name:"(none)"}],o=0;o<t.Data.length;o++){var a={id:t.Data[o].Id};try{a.name=n.decrypt(t.Data[o].Name)}catch(s){a.name="[error: cannot decrypt]"}r.push(a)}e.folders=r},function(){e.loadingFolders=!1}),e.folderSort=function(e){return e.id?e.name.toLowerCase():""},e.editSite=function(r){var n=t.open({animation:!0,templateUrl:"app/vault/views/vaultEditSite.html",controller:"vaultEditSiteController",resolve:{siteId:function(){return r.id},folders:function(){return e.folders}}});n.result.then(function(t){if("edit"===t.action){var r=o("filter")(e.sites,{id:t.data.id},!0);r&&r.length>0&&(r[0].folderId=t.data.folderId,r[0].name=t.data.name,r[0].username=t.data.username,r[0].favorite=t.data.favorite)}else if("delete"===t.action){var n=o("filter")(e.sites,{id:t.data},!0);if(n&&n.length>0){var a=e.sites.indexOf(n[0]);a>-1&&e.sites.splice(a,1)}}})},e.$on("vaultAddSite",function(t,r){e.addSite()}),e.addSite=function(r){var o=t.open({animation:!0,templateUrl:"app/vault/views/vaultAddSite.html",controller:"vaultAddSiteController",resolve:{folders:function(){return e.folders},selectedFolder:function(){return r}}});o.result.then(function(t){e.sites.push(t)})},e.deleteSite=function(t){confirm("Are you sure you want to delete this site ("+t.name+")?")&&r.sites.del({id:t.id},function(){var r=e.sites.indexOf(t);r>-1&&e.sites.splice(r,1)})},e.editFolder=function(r){var n=t.open({animation:!0,templateUrl:"app/vault/views/vaultEditFolder.html",controller:"vaultEditFolderController",size:"sm",resolve:{folderId:function(){return r.id}}});n.result.then(function(t){var r=o("filter")(e.folders,{id:t.id},!0);r&&r.length>0&&(r[0].name=t.name)})},e.$on("vaultAddFolder",function(t,r){e.addFolder()}),e.addFolder=function(){var r=t.open({animation:!0,templateUrl:"app/vault/views/vaultAddFolder.html",controller:"vaultAddFolderController",size:"sm"});r.result.then(function(t){e.folders.push(t)})},e.deleteFolder=function(t){confirm("Are you sure you want to delete this folder ("+t.name+")?")&&r.folders.del({id:t.id},function(){var r=e.folders.indexOf(t);r>-1&&e.folders.splice(r,1)})},e.canDeleteFolder=function(t){if(!t||!t.id)return!1;var r=o("filter")(e.sites,{folderId:t.id});return 0===r.length}}]),angular.module("bit.vault").controller("vaultEditFolderController",["$scope","apiService","$uibModalInstance","cryptoService","cipherService","folderId","$analytics",function(e,t,r,o,n,a,s){s.eventTrack("vaultEditFolderController",{category:"Modal"}),e.folder={},t.folders.get({id:a},function(t){e.folder=n.decryptFolder(t)}),e.savePromise=null,e.save=function(o){var i=n.encryptFolder(o);e.savePromise=t.folders.put({id:a},i,function(e){s.eventTrack("Edited Folder");var t=n.decryptFolder(e);r.close(t)}).$promise},e.close=function(){r.dismiss("cancel")}}]),angular.module("bit.vault").controller("vaultEditSiteController",["$scope","apiService","$uibModalInstance","cryptoService","cipherService","passwordService","siteId","folders","$analytics",function(e,t,r,o,n,a,s,i,l){function c(e){var t=$(e.trigger).parent().prev();"text"===t.attr("type")&&t.select()}l.eventTrack("vaultEditSiteController",{category:"Modal"}),e.folders=i,e.site={},t.sites.get({id:s},function(t){e.site=n.decryptSite(t)}),e.save=function(o){var a=n.encryptSite(o);e.savePromise=t.sites.put({id:s},a,function(e){l.eventTrack("Edited Site");var t=n.decryptSite(e);r.close({action:"edit",data:t})}).$promise},e.generatePassword=function(){e.site.password&&!confirm("Are you sure you want to overwrite the current password?")||(l.eventTrack("Generated Password From Edit"),e.site.password=a.generatePassword({length:10,special:!0}))},e.clipboardSuccess=function(e){e.clearSelection(),c(e)},e.clipboardError=function(e,t){t&&c(e),alert("Your web browser does not support easy clipboard copying. Copy it manually instead.")},e.folderSort=function(e){return e.name.toLowerCase()},e["delete"]=function(){confirm("Are you sure you want to delete this site ("+e.site.name+")?")&&t.sites.del({id:e.site.id},function(){r.close({action:"delete",data:e.site.id})})},e.close=function(){r.dismiss("cancel")}}]);